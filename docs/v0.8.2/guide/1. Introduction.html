<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>1 Introduction 0.8.2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/1.%20Introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/2.%20Plugin%20concepts.html"><strong>2</strong><span>Plugin concepts</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/3.%20Testing.html"><strong>3</strong><span>Testing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/4.%20Scripts.html"><strong>4</strong><span>Scripts</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/5.%20Changelog.html"><strong>5</strong><span>Changelog</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Multi tenant setup focused on single database mode</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/2.%20Plugin%20concepts.html"><strong>2</strong><span>Plugin concepts</span> >></a></div>
                


                <div class="project">
                    <h1>1 Introduction - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Kim A. Betti</p>

                    <p><strong>Version:</strong> 0.8.2</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#1.1%20This%20plugin%20vs.%20multi-tenant-core"><strong>1.1</strong><span>This plugin vs. multi-tenant-core</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#1.2%20Design%20goals"><strong>1.2</strong><span>Design goals</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#1.3%20Single%20database%20mode"><strong>1.3</strong><span>Single database mode</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#1.3.1%20Indexing%20your%20database"><strong>1.3.1</strong><span>Indexing your database</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="1. Introduction">1 Introduction</h1>
The MultiTenant - SingleDB plugin aims to make it easy to set up and develop a multi-tenant application based on Hibernate. 
A multi tenant application will let you run multiple users or customers in the same application instance without them 
being able to see or modify each others data.<p class="paragraph"/>So far this plugin works in "single database" mode. What this means is that all your tenants will share the same database and tables. 
Hibernate will re-write queries before they hit the database so only data belonging to the  <em class="italic">current</em>  tenant will be fetched. 
Do note that some companies won't allow you to store their data in the same database as other customers.<p class="paragraph"/>This is usually used on SaaS applications, where you can sign-in to have one 'instance' of the offered application so you'll 
probably have your own URL (username.app.com).<p class="paragraph"/>Check these links to read about Multi-Tenancy
<ul class="star">
<li><a href="http://en.wikipedia.org/wiki/Multitenancy" target="blank">http://en.wikipedia.org/wiki/Multitenancy</a></li>
<li><a href="http://msdn.microsoft.com/en-us/library/aa479086.aspx" target="blank">http://msdn.microsoft.com/en-us/library/aa479086.aspx</a></li>
</ul><p class="paragraph"/>


<h2 id="1.1 This plugin vs. multi-tenant-core">1.1 This plugin vs. multi-tenant-core</h2>
Those of you who has been using the multi-tenant plugin for a while are probably using multi-tenant-core. 
This great plugin was unmaintained for a long time and suffered from a list of minor and major problems. 
The plugin made use of some classes from the unofficial <code>sun.*</code> package, had compatibility problems with recent 
versions of Grails and used some intrusive means in order to intercepting Hibernate Sessions and criteria. 
Another problem was that webflow support added a compile-time dependency to the webflow plugin. 
This caused web flow support to be dropped from the multi-tenant-core plugin.<p class="paragraph"/>At some point Scott Ryan took over maintenance of the plugin. 
A few months later the multi-tenant organization was formed on GitHub by a group of developers invested in the plugin.
The organization was formed to drive the plugin development forward. The most serious problems mentioned above has been fixed
in the current version of multi-tenant-core.<p class="paragraph"/>Kim A. Betti started working on webflow support without compile time dependency and a less intrusive way of intercepting Hibernate sessions. 
The result of this work was this plugin (multi-tenant-single-db). The original plan was to merge at least some of the solutions in this plugin back into 
<a href="http://github.com/multi-tenant/grails-multi-tenant-core" target="blank">multi-tenant-core</a>, but the plugins has drifted further apart while refactoring and 
improving single-database mode. 
<ol>
<li>Merging the changes back into multi-tenant-core would introduce unnecessary dependencies (Hawk Eventing and Hibernate Hijacker) for those using the plugin in multi-database mode.</li>
<li>Some of the changes in this plugin would break existing applications.</li>
<li>Align the plugin more closely with the most common use cases.</li>
</ol><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Feature</strong></th><th><strong class="bold">multi-tenant-single-db</strong></th><th><strong class="bold">multi-tenant-core</strong></th></tr><tr class="table-odd"><td>Multi database mode</td><td>No</td><td>Yes</td></tr><tr class="table-even"><td>Single database mode</td><td>Yes, based on Hibernate Filters</td><td>Yes, based on Criteria / Query manipulation</td></tr><tr class="table-odd"><td>HQL support</td><td>Yes, based on Hibernate Filters</td><td>No</td></tr><tr class="table-even"><td>Webflow support</td><td>Yes, without compile time dependency</td><td>No</td></tr></table><p class="paragraph"/>
<strong class="bold">Short version:</strong> If you want support for multi database mode then your only option is to go with multi-tenant-core. 


<h2 id="1.2 Design goals">1.2 Design goals</h2>
<h3>Main focus</h3>
<ol>
<li>Focus on single-database mode, while trying to keep the door open for later support for database per tenant as long as it doesn't add too much complexity.</li>
<li>Make sure that the webflow plugin is supported. Without forcing anyone to install it into their projects.</li>
<li>Leverage existing Spring and Hibernate solutions where possible.</li>
<li>Cover as much as possible with unit and integration tests (many features are <strong class="bold">very</strong> difficult to test properly)</li>
<li>Re-think some design decisions and add more support for the most common use cases.</li>
</ol><p class="paragraph"/><h3>Very long term, possibly never (depending on interest and patches)</h3>
<ol>
<li>Create a separate core plugin independent of Hibernate.</li>
<li>Support multiple-database mode? Hibernate Shards? There are rumors on the street talking about Multi Tenant support in Hibernate 4.</li>
<li>Implement support forÂ name-of-latest-and-greatest-nosql-hype-here</li>
</ol><p class="paragraph"/>


<h2 id="1.3 Single database mode">1.3 Single database mode</h2>
This plugin is (at least for the time being) focusing solely on single database mode. 
What this means is that every tenant (user, customer..) shares that same database. 
Hibernate will filter all queries targeting multi-tenant domain classes before they hit the database.<p class="paragraph"/>With a multi database approach tenant data will be stored in separate databases. 
This is often a requirement from 'enterprise' customers like banks, governments 
where developers are outnumbered by lawyers by a factor off 5.<p class="paragraph"/><h4>Pros</h4>
<ul class="star">
<li>Tenants can be created and deleted without any maintenance overhead.</li>
<li>You can backup and restore everything in one operation.</li>
</ul><p class="paragraph"/><h4>Cons</h4>
<ul class="star">
<li>Some backup scenarios are actually more difficult. In a multi database environment you can backup and restore individual tenants. This is obviously a lot more tricky if all tenants share one database.</li>
<li>You might run into database scaling challenges if your tenants produce a lot of data. You might look into key based partitioning in your database.</li>
</ul><p class="paragraph"/>This is by no means a complete list, it's just a couple of points from the top
of my head to give you an idea of what you're buying into, feel free to suggest more pros'n'cons.<p class="paragraph"/>


<h2 id="1.3.1 Indexing your database">1.3.1 Indexing your database</h2>
There is a great post regarding how to do it with <strong class="bold">grails</strong> + <strong class="bold">multi-tenant-single-db</strong> + <strong class="bold">mysql</strong> here: 
<a href="http://www.developer-b.com/blog/entry/2014/2011/feb/23/grails-multi-tenant-and-database-indexes" target="blank">Grails: Multi tenant architecture and database indexes </a><p class="paragraph"/><h3>Trivial example</h3><p class="paragraph"/>If you just want to index your tenantId property to allow faster scans in your table, this would fit:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.multitenant.core.annotation.MultiTenant<p class="paragraph"/>@MultiTenant
class Animal &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> name<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        tenantIdIndex indexColumn: &#91;name: <span class="java&#45;quote">"tenantId"</span>, type:<span class="java&#45;object">Integer</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Multi-column indexes</h3><p class="paragraph"/>Multi-column indexes are better to use when you know witch columns you have to index. 
Check the link above to understand how they work and how they can benefit your application.<p class="paragraph"/>If you want to define multi-column indexes on your domain classes you may take a look into 
<a href="http://multi-tenant.github.com/grails-hibernate-hijacker/docs/v0.6/guide/2.%20Features.html#2.5.%20Composite%20index%20DSL" target="blank">grails-hibernate-hijacker docs</a> 
to understand how its DLS achieves it.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.multitenant.core.annotation.MultiTenant<p class="paragraph"/>@MultiTenant
class User &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> username<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        tenantIdIndex indexColumn: &#91;name: <span class="java&#45;quote">"tenantId"</span>, type:<span class="java&#45;object">Integer</span>&#93;
    &#125;<p class="paragraph"/>    // This will allow fast lookup on tenant alone and in
    // combination with username.
    <span class="java&#45;keyword">static</span> indexes = &#123;
        tenant_username_idx 'tenant_id', 'username'
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><blockquote class="note"> 
Support for the <code>indexes</code> DSL is provided by Hibernate Hijacker. 
This is an experimental feature and might change in the future.  
</blockquote>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item next-right"><a href="../guide/2.%20Plugin%20concepts.html"><strong>2</strong><span>Plugin concepts</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    Have a nice day!
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
