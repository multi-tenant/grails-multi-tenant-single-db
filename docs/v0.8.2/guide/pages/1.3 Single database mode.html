<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>1.3 Single database mode 0.8.2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/1.%20Introduction.html"><strong>1</strong><span>Introduction</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/2.%20Plugin%20concepts.html"><strong>2</strong><span>Plugin concepts</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/3.%20Testing.html"><strong>3</strong><span>Testing</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/4.%20Scripts.html"><strong>4</strong><span>Scripts</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/5.%20Changelog.html"><strong>5</strong><span>Changelog</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Multi tenant setup focused on single database mode</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/2.%20Plugin%20concepts.html"><strong>2</strong><span>Plugin concepts</span> >></a></div>
                


                <div class="project">
                    <h1>1.3 Single database mode - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Kim A. Betti</p>

                    <p><strong>Version:</strong> 0.8.2</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#1.3.1%20Indexing%20your%20database"><strong>1.1</strong><span>Indexing your database</span></a>
                    </div>
                    
                </div>
                

                

<h2 id="1.3 Single database mode">1.3 Single database mode</h2>
This plugin is (at least for the time being) focusing solely on single database mode. 
What this means is that every tenant (user, customer..) shares that same database. 
Hibernate will filter all queries targeting multi-tenant domain classes before they hit the database.<p class="paragraph"/>With a multi database approach tenant data will be stored in separate databases. 
This is often a requirement from 'enterprise' customers like banks, governments 
where developers are outnumbered by lawyers by a factor off 5.<p class="paragraph"/><h4>Pros</h4>
<ul class="star">
<li>Tenants can be created and deleted without any maintenance overhead.</li>
<li>You can backup and restore everything in one operation.</li>
</ul><p class="paragraph"/><h4>Cons</h4>
<ul class="star">
<li>Some backup scenarios are actually more difficult. In a multi database environment you can backup and restore individual tenants. This is obviously a lot more tricky if all tenants share one database.</li>
<li>You might run into database scaling challenges if your tenants produce a lot of data. You might look into key based partitioning in your database.</li>
</ul><p class="paragraph"/>This is by no means a complete list, it's just a couple of points from the top
of my head to give you an idea of what you're buying into, feel free to suggest more pros'n'cons.<p class="paragraph"/>


<h2 id="1.3.1 Indexing your database">1.3.1 Indexing your database</h2>
There is a great post regarding how to do it with <strong class="bold">grails</strong> + <strong class="bold">multi-tenant-single-db</strong> + <strong class="bold">mysql</strong> here: 
<a href="http://www.developer-b.com/blog/entry/2014/2011/feb/23/grails-multi-tenant-and-database-indexes" target="blank">Grails: Multi tenant architecture and database indexes </a><p class="paragraph"/><h3>Trivial example</h3><p class="paragraph"/>If you just want to index your tenantId property to allow faster scans in your table, this would fit:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.multitenant.core.annotation.MultiTenant<p class="paragraph"/>@MultiTenant
class Animal &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> name<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        tenantIdIndex indexColumn: &#91;name: <span class="java&#45;quote">"tenantId"</span>, type:<span class="java&#45;object">Integer</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Multi-column indexes</h3><p class="paragraph"/>Multi-column indexes are better to use when you know witch columns you have to index. 
Check the link above to understand how they work and how they can benefit your application.<p class="paragraph"/>If you want to define multi-column indexes on your domain classes you may take a look into 
<a href="http://multi-tenant.github.com/grails-hibernate-hijacker/docs/v0.6/guide/2.%20Features.html#2.5.%20Composite%20index%20DSL" target="blank">grails-hibernate-hijacker docs</a> 
to understand how its DLS achieves it.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.multitenant.core.annotation.MultiTenant<p class="paragraph"/>@MultiTenant
class User &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> username<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        tenantIdIndex indexColumn: &#91;name: <span class="java&#45;quote">"tenantId"</span>, type:<span class="java&#45;object">Integer</span>&#93;
    &#125;<p class="paragraph"/>    // This will allow fast lookup on tenant alone and in
    // combination with username.
    <span class="java&#45;keyword">static</span> indexes = &#123;
        tenant_username_idx 'tenant_id', 'username'
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><blockquote class="note"> 
Support for the <code>indexes</code> DSL is provided by Hibernate Hijacker. 
This is an experimental feature and might change in the future.  
</blockquote>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item next-right"><a href="../../guide/2.%20Plugin%20concepts.html"><strong>2</strong><span>Plugin concepts</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    Have a nice day!
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
